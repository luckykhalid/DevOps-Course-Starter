env:
  global:
  - secure: JjbU69ZIQ63AoiN9iBwg3QdbVOmV/mJKdv62CjaliD1iP7Szm0mr8ZZ3zpquxdi+JCVzBqc9nQOmKBtSc+DAK3dtFnr/zq6kboSEexzj92orBgsB4fLyJKky8I0POTLyv/6CGEWKfuF1g1XFjHou/8DQLc6YQ6JSn/lIojPXuJrawb7Dz9HXq87SAZH43m5UPnev0JhlI1ePZiWPPPsgeDKCewioUBWafjx1O6NlI3Ael093HYlST+RgzW4mAWK1j3/fAHLlQlOn6yW+VvZhyaqToQ0cyqM0GQYIwo53q/ssjiUeaiEQKI7qpH/zhxfHaRJ0qfHrBxnMf69WC08V1DjlBuUwKOuWDU9VxeCcXFYxHdPApSmw68C5bMr7baaYeHmUrpeldox6gFyElxj8QLiFAFIEC4Qi3x24m8er8FtP8dPgSyfttBdF6znAPQFDKWPA4XuIN2x9IARbITElcH0tEAg8YmkK0ImCANV3x/gzMlRSyEiUzI3o+IYtmf66xa4yvW2ldCfFWaTAPIbVSPOKHCm+SFZEhfP8YbagTpzJGkHEmuG7ezMmBkN/F12jwNS1zE0w4KDF0TvaRjgzltawvKmuE5fy9pp3QHGy6m5W+b8v/NwneM4f7EifXXwMNAAxEbiFwSEaZHqNQaodAq/QIdBKqv0NJfbj+UJD08k=
  - MONGO_USER=khalid-devops
  - secure: lxzWG/6/sUVeYPoaE4RLC6hjcYepM2kGz99MKmRV3ei2sdtB8R6bbmVHtDbZ4/MjWUlhqsaSETnsRGg4/EBaigw7fs2L5lwtCUaOj0NLynbZMyWaIv1JLXBqwPP84aZalCI9W4RkprOc4QC8nS/V6gSf9afTk80U2CsfQeFStnmPvdau2y9KdmaA1PpI9QzDWHDhpk053lVdsDJcsfAjkm/vNC5IcLwuXX2+ATtK3Mw05Gd/T8Tr0pRaMfUDL9EfiJj/CtGVX46fDKxDVrwmiUXdDWccQF9/nfkZbsuCv2KXdPqiGPGF+ilC5aeRy0i7B2MA8Ebq+pp9Aa9Gzbgbl4FrTW14IJVIkS3RV3iXcSRbMLHTmSkla7/hasRYnqnG3HZAFCVm6CAENdwLAL7itGbLgjKvK27NegcedGIH4EE0tAG7CNRcImWxFmibmJ7r7v0N5dDzLwO3K6sspyc8oiCw6oaTI4MAub/eyNZNKJ7/gOimAhyh5/9DfK/gxEV6G4MWUNd3Z3z0xH/xWm21xy6BZc7eROcacWstdvbF2OUMlmqWbt+U2Zr2fDxQyh8h6gNhqZ18N0stW9D46ucvm9DVuhlVDNGZedmEhwTfLHUKqjrhHgQuGIHD0y/mLgP0/md3OTdq8Aehj1DD8UHstSiRXX98POaT888srehmfSE=
  - MONGO_DB=devops
  - DOCKER_USER=khalidashraf
  - secure: WrccS5O4eSH8/HKUukA+cJxa+2wCkj/f4lYgWBeGFpoX2xFVICYiYfp5cHSL6VYFCieq24LCufdhB7JvJ+JWjbmmrElC4aluNSfRgpwQBlN7OTVmMwCEzII3Uu8tIww8md7/mIdG/6YBSDPWFPo17tFI69bx0t1AXUWts3WLHTuVilp3EFrlZXpnUKR3d91hSQ+9hG3UnGP8fLAlC/D2b/3gVuCZ7tv9zrcQWh4zFDYIjxT6SKeiOOwwlC9i9qGb6pcDxFxHjMVgXtLU1ue6Gh9KPXyd3WRyPmKd/mxrH8qCw6tad+/gsSk25Vkue+dKQs8F4+Qkc8L2IwcdwIq8ty12Wfu2Wc7GSC7mSCdwq1AySRqOVcAWIlCSGPHP7Rv3bC7RQ0i1CQaRlV4ch/3LfXBva1DfFG01gAKqimmwvT0yCxN8g+MT7pnYfSofnCFFZsuCpahyT1B36wkB9hBAxeUYRO1vi1+scu48J++YfXBqXyvgZm+CnsHv1UsWAYdt5YT1VRnOumJ564wZS64x4MUyKqsFDZvdpB6VICmtwJYk2fcQ4UQ1jL6Hvkezqh7BJew1Osw3LSRr3Y/90iywMAF70/bEKS0E3s2xZVVfblxDOEtlBoEFIgNyBR/TX2fQ2Vi2xo9i0gtV8JtFmwUaYnKzmEsckGaTSyruuYAgbjs=
  - HEROKU_APP=khalidashraf-todo-app
  - secure: j9yGr8VrXd5o6pr6yAzAnK7DzyaDgZ8uKf5sp8tWKhu3wEuQenx3jFKndrl6w82AP3J+srBVw+yDv4e5GwGSSZ6HtF4F6AEUp+MVjg90NJwEjJuHO3FwsdkZNGncIEix044M7oA2nmoWQPZoSZ6XQRGZRa6xJrA4Y04s2Fwk+q9EdFnX4cRCcDc+7V9zkgdTEJneOEOpR2ElMz0z4/NWb357jmK37GdY4nvT3C+gEUqhKGp/de1FoNSLnlWmoKFXEtbUNqI4jhepf+QO4+KFlSJJBYOOPD308dt12vAdthv2VxKNYWh62KF4IfL/HAhPY13ZmWYtZC/K4aT1geoLkL1RHRIrvJQcCdSwQ+KwHRRsLE24SY1KeLxDOYCk5VZZ0wjjI1efeRjQc/MoGXSI0ems9bI5aWBQn2EVymHpRg8k+eMCcb2NUa8QU409hE73z0g0NvyIZRHzYS1CCZuEsbrXGcP0EOn8SD0+6mTo8PyqFzQ226t33/XEkbbU1ZGOHb7/eZKh3vU/iWx1AP4hakD9OF4dg3/2qgnnFItAkW5ZEu01O7AeHYr4As3n7mQqXVboq0Sb/eR3CC7JnZ4QoT30nc/5SBoYZYO9QkTW/Sh8e1bd+vVaAboOIF5S1+0nSTIy3mKQLsx7xygvLEGeaDsioL1JqWen7FKh68DD0Js=
  - secure: Q+jfk7gIgAfkhoEEomitPwvh/PpOWG5pKgM08DX4DjvP+aSoc/nk9ijZnPzAwxZaoGKzb9M6MLNtRq4HSNLntCO55WWL2H43GlpYSuifZfGhg+684gx0oraz0H/QzppSEjayWNswEq6PVGp3TmVjSbfaDgowFW/VzPhJnS9dSUnlD0odStwGJTSMyFSGp2jWAZ8PoX7x5rf/Op1KhQXBHyP6dwL7B9tZkw+wu3mYb0fsvWONUHEJbjEiBg1gL5esrH6IIEU7F3KxN4WeYIDC3GTVwWjlolVo7pBds3YeFOX8shjlXWsaNam9BKDrkMuDKBYYzFzoZoAq8zXN6DbTKPKKYY4GotxStxuyh/Pzo6GjDFSi/X/b8R5y3249R8XkO1BDYo+7tFbnFI/q8kBvGx937cmwxQcKKxDUctIGZ/frLcR7NXtHHKOIni5hX6YWhRXH8EzJ2qYYMRNP2oRqnXNZ6HcolMeZgPYePLU39jK5sxzf+DApM3EJMDgjwANUCqwc1bx7gaR3ImMI2bf5+7uvXQXOLaW5QlFTYYDLmxVm+HR66h1/ObSa2gl8dIzjA4y6jg3mh8eC31ApEfvPYe9/6JJxmJ8P9WxvHCcTQNrwIu3FDhC06+NF9ZsLDL8W142TV9MmqdO9PEwFyfqPRxRxZzv9fGjhwHAwgFJ1KP0=
  - OAUTH_AUTHENTICATE_URL=https://github.com/login/oauth/authorize
  - OAUTH_REDIRECT_URL=http://127.0.0.1:5000/login/callback
  - OAUTH_ACCESS_TOKEN_URL=https://github.com/login/oauth/access_token
  - OAUTH_USER_URL=https://api.github.com/user
  - ROLE_WRITER_USERS=luckykhalid
  - secure: C5wycrckuDnyFRaRppDsIY5R1jA1/bnyCriLdJexqCPPbA0eUn8pjpdkE8dB8AE+Nxs4KPqEFU6GZSE2VyJiO2VTBqtttlmgQZPRHYzQLrToxX0VLVCB3Y4WcvrKSb1H06wzeaTaViQ6sTNGZSmLSuuNXl4hyW0AleSwJgjn+5x2YtfH9V+IKndphLO16ZWQ2n64h4001lW++kF9nLqfnzTw95OsPR6VV5nyrgbrlD1un1pMOKOdb4K185DXGD+tFmyDleRXz5LOVMObocxw9YWH2SnNKZS++RUxmVAogB1RgkdgucBqCz/TduhTKN029/lguYmlew8jagtF0gxvvIAmlKB70qZ+G/wf+1E6pmnb037H4KSPvImUfr519/E83QQBq77fsJjosW1jtzdlWUv9qqlVnpx7DlH5htBiRj55zDEwSgTTLBSPxT+AkOGjhgyU6Bn8s+WekUJUE1EriFgdI9JMGEV6Xv/iHRJtjXaJLa6m2yLytZdHJbhnvCEKniTGgcF47hwvIz8gekv2JeR2wdX9vjEt1q7JOJuD/yVSRHE+Ar8LE8uZXXd4ZR+Znoimg+/JKpkfdqmN+55BYHHIanSbGKQ/tWowJ6wMRq5x4LqEhXQaoNZjF6C6hwCfEQDAlvlPucLeZ166t5ZmRZlaiYtkBNs++pUpgLUOv2g=
  #- WEBHOOK_URL=https://\$khalidashraf-todo-app:c80bS3GmCjkRhuyNEARhMq52c3SYFQG2voBws2CK0m9KmbbgFkCLcLQ1vheo@khalidashraf-todo-app.scm.azurewebsites.net/docker/hook
services:
- docker
  
script:  
  # Build test image and test the code  
  - docker build --target test --tag todo_app:test .
  - docker run --env-file .env.test todo_app:test tests
  - docker run -e SECRET_KEY -e MONGO_USER -e MONGO_PASS -e OAUTH_CLIENT_ID -e OAUTH_CLIENT_SECRET -e OAUTH_AUTHENTICATE_URL -e OAUTH_REDIRECT_URL -e OAUTH_ACCESS_TOKEN_URL -e OAUTH_USER_URL -e ROLE_WRITER_USERS todo_app:test tests_e2e
  # Redeploy to Azure
  - bash ./webhook.sh
  

deploy:
  provider: script
  script: bash ./build-deploy.sh
  on:
    branch: master

notifications:
  slack:
    secure: o5cEaHOFMzW435cV5zT/4MaoyHC3X3DS9091yDH6SxwLy6F/rngAy5EwDZ53opq/YdWYyGhlumsiZFfVyI2qpyZSkE2Epk9p35YT0Gdx/x9oad91G8PeyaWSBN2GWfceZ/qBxTfamyACUPr2ItWi7oPw65RnYM/kRcbfmXnxC9bqQcDX0bLWVDRZtVmmsZJ0kNnCwznsBb9gpVV7Vz3ZVhv9QvFoYPyIDdyMT2vlYHu/iQ8FJIX9eKuYuqViklUiwWYIejUqp7892x3m5Bywm7e0Y0NqXmWbXsiW8MizQsn9E6M93Ed4+xNyKWz7f6O7GvVZm1GmdyH5FPB3Nz38FxOy6e4bYC8r399DJISZl0VMYtqDhKndoqRvSpR4tvvmad5x37mAMs2o1IpRc2OQTJ5Rtz54Hqw+gAHa3lvyFuz1QvMjaZnp9zXLy6dJYF6VIJu6FKDKQJwLbiYio18EqkxauxUGM0VB+12JiVds53aXNqlPkqopzhNdCKnSUlKH0yho6SJzzyYRnKG9vOGaIbx88Sf+PrEIYylXdFlsfH/I3bhFMkRN2EoHZpYaaDXPqxk/IXCUHNHU39cuu9CpQYFXt3rlirljBD/o2Oi3oiMXT36jFL37Oc4C3jxiv2cj0LLacgB/e0qwGqhjqjLerKiYPjh1vvdOt9aGvpXcIAA=
  email:
    recipients:
    - khalid.ashraf@hotmail.com
    on_success: never
    on_failure: always
